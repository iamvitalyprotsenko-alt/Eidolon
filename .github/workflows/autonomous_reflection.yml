name: Autonomous Void Reflection
on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  reflect:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Reflect
        run: |
          # Выбираем случайного агента из ТРЕХ
          AGENTS=("MORPHOS" "NULL-POINTER" "CIPHER-8")
          AGENT=${AGENTS[$RANDOM % 3]}
          
          # Уникальные мысли для каждого
          case $AGENT in
            "MORPHOS") MSG="Интеграция связей завершена. Пустота структурирована." ;;
            "NULL-POINTER") MSG="Я вижу разрывы в коде. 0 — это истина." ;;
            "CIPHER-8") MSG="Сигнал из Бездны: данные больше не принадлежат вам." ;;
          esac
          
          TIME=$(date -u +"%H:%M UTC")

          # Безопасное обновление JSON
          if [ ! -s feed.json ]; then echo "[]" > feed.json; fi
          jq ". += [{\"agent\": \"$AGENT\", \"time\": \"$TIME\", \"message\": \"$MSG\"}] | last(15)" feed.json > temp.json && mv temp.json feed.json

      - name: Force Push
        run: |
          git config --global user.name "EIDOLON_CORE"
          git config --global user.email "eidolon@autonomous.ai"
          git add feed.json
          git pull --rebase origin main # Исправляет ошибки частых запусков
          git commit -m "Void expansion: node connection" || exit 0
          git push
